VPATH = $(PWD)/cint:$(PWD)/src:$(PWD)/lib:$(PWD)/rbgui
SRC=$(PWD)/src
CINT=$(PWD)/cint
ROOTFLAGS=`root-config --cflags --libs`
DYLIB=-dynamiclib -single_module -undefined dynamic_lookup 


### In case your ROOT headers aren't searched for automatically, add
# -I/where/your/root/headers/are to the next line.
INCFLAGS=-I$(SRC) -I$(CINT) $(USER_INCLUDES)
CXXFLAGS=$(INCFLAGS) -L$(PWD)/lib
####CXXFLAGS=-ggdb -O0

###### USER HEADERS AND SOURCES GO HERE #######
USER_INCLUDES=-I/user/gchristian/soft/n2analysis/src/ -I/user/gchristian/soft/n2analysis/include/

USER_HEADERS=$(SRC)/ExampleData.hh /user/gchristian/soft/n2analysis/src/mona.hh /user/gchristian/soft/n2analysis/src/detector.hh /user/gchristian/soft/n2analysis/src/unpacker.hh

USER_SOURCES=/user/gchristian/soft/n2analysis/src/mona.cc /user/gchristian/soft/n2analysis/src/unpacker.cc

##############################################



#### MAIN PROGRAM ####
all: rootbeer


rootbeer: libHist.so libRootbeer.so $(SRC)/main.cc 
	g++ $(CXXFLAGS) -lRootbeer $(SRC)/main.cc -o rootbeer $(ROOTFLAGS)


#### ROOTBEER LIBRARY ####
SOURCES=$(SRC)/Rootbeer.cxx $(SRC)/Data.cxx $(SRC)/Skeleton.cxx $(SRC)/Unpack.cxx $(SRC)/Canvas.cxx $(SRC)/WriteConfig.cxx \
	$(USER_SOURCES)
HEADERS=$(SRC)/Rootbeer.hxx $(SRC)/Data.hxx $(USER_HEADERS)

libRootbeer.so: libHist.so cint/RBDictionary.cxx $(SOURCES)
	g++ $(CXXFLAGS) -lHist -o $(PWD)/lib/$@ $(ROOTFLAGS) -lThread $(DYLIB) -p cint/RBDictionary.cxx $(SOURCES)


cint/RBDictionary.cxx: $(HEADERS) Linkdef.h
	rootcint -f $@ -c $(CXXFLAGS)  -p $^



#### COMPILE HISTOGRAM LIBRARY ####

libHist.so: Hist.cxx cint/HistDictionary.cxx
	g++ -o $(PWD)/lib/$@ $(CXXFLAGS) $(ROOTFLAGS) -lTreePlayer $(DYLIB) -p $^


cint/HistDictionary.cxx: Hist.hxx LockingPointer.hxx HistLinkdef.h
	rootcint -f $@ -c $(CXXFLAGS) -p $^



#### REMOVE EVERYTHING GENERATED BY MAKE ####

clean:
	rm -f lib/*.so rootbeer cint/RBDictionary.* cint/HistDictionary.* rbgui/HistDict.*



#### FOR DOXYGEN ####

doc:
	cd $(PWD)/doxygen ; doxygen Doxyfile ; cd latex; make; cd $(PWD)

doccopy:
	cd $(PWD)/doxygen ; doxygen Doxyfile ; cd latex; make; cd $(PWD) ; \
	$(PWD)/doxygen/copydoc.sh




#### GUI STUFF ####


GUI=$(PWD)/rbgui
GUIHEADERS=$(GUI)/HistViewer.h $(GUI)/HistMaker.h $(GUI)/TH2D_SF.h $(GUI)/TH1D_SF.h $(GUI)/TH3D_SF.h
GUISOURCES=$(GUI)/HistViewer.cc $(GUI)/HistMaker.cc $(GUI)/TH2D_SF.cc $(GUI)/TH1D_SF.cc $(GUI)/TH3D_SF.cc

GUIROOTFLAGS=-dynamiclib -single_module -undefined dynamic_lookup `root-config --cflags --libs` -lTreePlayer

GUICXXFLAGS=-fPIC

gui: librbgui.so

librbgui.so: libHist.so HistDict.cxx $(GUISOURCES)
	g++ -L$(PWD)/lib -lHist -shared -o $(PWD)/lib/$@ $(GUICXXFLAGS) -I/opt/local/include/root $(GUI)/HistDict.cxx $(GUISOURCES) $(GUIROOTFLAGS) -I$(PWD)/src

HistDict.cxx: $(GUIHEADERS) rbgui/Linkdef.h
	rootcint -f rbgui/$@ -c -Isrc $(GUICXXFLAGS) -p $^

#HistViewer.o:
#	g++ -c $(ROOTFLAGS) $(CXXFLAGS) HistViewer.cc

guiclean:
	rm -f lib/librbgui.so rbgui/HistDict.*
